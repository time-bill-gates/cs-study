# 컴퓨터 구조

![](./computer%20architecture.png)

# 프로세스
- 프로그램
    - 실행 가능한 명령어와 데이터의 집합
- 프로세스
    - 실행 중인 프로그램
    - 운영체제로 부터 사용할 수 있는 메모리 공간을 할당 받는다
        - 할당받은 메모리는 사용처에 따라 스택, 힙, 데이터, 코드 영역으로 구분한다
- 운영체제의 고민
    - 어떻게 적은 수의 CPU로 많은 프로세스를 동시에 실행할 까


## 프로세스 제어 블록 Process Control Block, PCB
- 프로세스 상태 파악을 위한 자료구조
- PID
    - 프로세스 식별자
- 프로세스 상태
    - 실행 중, 대기 중, 중지
- PC
    - 다음 실행할 명령어가 보관된 메모리 주소
- register
    - CPU에서 현제 프로세스가 처리하는 명령어를 위해 사용하는 데이터 값
- 프로세스 테이블
    - 모든 프로세스 관리 자료구조
    - PCB를 요소로 갖는다

# user mode 와 kernel mode
- 운영체제는 프로세스가 컴퓨터 시스템 자원에 직접 접근하도록 허락하지 않는다
- 사용자 모드
    - 응용 프로그램 실행 모드
    - 시스템 자원 접근에 있어 제한된 권한을 갖습니다
- 커널 모드
    - 시스템 자원 접근 가능
- 인터럽트
    - 프로세스에게 주의 이벤트를 알리는 신호
    - 현재 실행 중인 프로세스를 중지 시키고 인터럽트 처리기가 제어권을 갖습니다
    - 하드웨어 또는 소프트웨어의해 발생 가능


# 문맥 교환 Context Switch
- 문맥 Context
    - 프로세스의 레지스터 값
- 타이머 인터럽트
    - 주기적으로 발생하는 인터럽트
    - 현재 실행중인 프로세스를 중단 시켜 스케줄링을 하기 위해 사용

![](./context%20switch.png)


## 관련 시스템 콜
### Fork
- 프로세스 생성 시스템 콜
- 호출하는 프로세스를 부모 프로세스 호출로 생성된 프로세스를 자식 프로세스라 한다
- 상세 동작
    - 자식 프로세스를 위한 PCB 생성, 초기화
    - 부모 프로세스의 메모리 공간을 복사, Copy On Write
    - 부모 프로세스에서 열린 파일 디스크립터 복사
    - 부모 프로세스의 fork는 자식 프로세스의 PID, 자식프로세스에선 fork는 0을 반환
    - 자식 프로세스 스케줄링 참가
    - 자식 프로세스는 fork 호출 직후부터 명령어 실행


### wait
- 프로세스 대기 시스템 콜
- 부모 프로세스가 자식 프로세스의 종료를 기다립니다
- 좀비 프로세스 생성 방지
    - 실행 종료되었지만 프로세스 테이블에서 제거되지 않은 프로세스
    - 부모가 종료를 확인하지 못한 자식 프로세스
    - ps 명령어로 확인 시 상태가 'z'입니다
    - 부모 프로세스에서 wait를 호출하면 좀비 프로세스가 제거됩니다

### exec
- 프로세스가 다른 프로그램을 실행하는 시스템 콜
- 새 프로그램을 실행할 때마다 프로세스를 생성할 필요가 없다

### 쉘 구현
- 실행시 fork를 호출해 자식 프로세스 생성
- 사용자가 입력한 명령어는 자식 프로세스에서 exec 호출로 동작
- wait를 이용해 쉘은 사용자가 입력한 명령어가 자식프로세스에서 다 실행되기 까지 대기한다

# 스레드
- 프로세스가 수행하는 작업의 가장 작은 단위
    - 하나의 프로세스는 하나의 스레드일 수도 있고 프로그램 코드에 따라 다수의 스레드로 동작할 수도 있다
- 하나의 프로세스의 스레드 들은 메모리의 코드, 데이터, 힙 영역을 공유하고 스택 영역은 개별로 갖고 있다
    - 레지스터, PC도 스레드별로 관리한다

# 멀티 프로세스
- 하나가 아닌 다수의 CPU가 존재하는 컴퓨터 시스템


# 스케줄링
- 평가 항목
    - 공정성
        - 모든 프로세스가 CPU를 공평하게 사용하는게
    - 처리 시간
        - 프로세스가 시작부터 완료까지 걸린시간
    - 응답 시간
        - 프로세스가 시작부터 사용자에게 첫 응답이 오기까지 걸린 시간

## 선입 선출 FIFO
- 먼저 실행한 프로세스를 먼저 수행

## 최단 작업 우선 SJF
- 작업 시간이 짧은 프로세스 부터 우선 수행

## 최소 잔여 우선 STCF
- 남은 작업 시간이 짧은 프로세스 부터 우선 수행

## Round Robin
- 모든 프로세스는 동일한 우선순위를 가진다
- 프로세스 스케줄링은 큐에서 관리
- 큐의 맨 처음 프로세스가 CPU 점유
- CPU점유한 프로세스는 정해진 시간동안 처리 후 CPU 반납, 큐에 다시 삽입된다

## Multi Level Feedback Queue
- 프로세스별 우선순위 존재, 이는 바뀔 수 있다
- 우선순위가 높은 프로세스가 CPU를 점유
- 우선순위가 같은 프로세스중에선 Round Robin으로 CPU를 점유
- 프로세스가 시스템에 처음 실행되면 가장 높은 우선순위를 가진다
- 우선순위 별로 시간이 정해져 있으며 우선순위가 높을 수록 이 시간은 짧다
- 프로세스가 우선순위에 시간 이내로 CPU를 반납하면 다시 같은 우선순위의 큐로 삽입되고 초과하면 우선순위를 하나 낮춘다
- 시스템에서 정한 주기 시간이 되면 대기큐의 모든 프로세스를 최상위 우선순위로 올린다
