# TCP
- Transmission Control Protocol
- 전송 제어 프로토콜

## 세그먼트
- TCP에서 사용하는 데이터 단위
- header(20 Byte) + 데이터 로 구성

### 헤더
- 출발지 port
- 목적지 prot
- 시퀀스 번호
- 헤더 길이
- 체크섬
- 등


## 연결 지향: 연결 맺기 3 way Hand Shake
- 송신자와 수신자간에 연결을 맺어 데이터를 주고 받습니다
- step 1
    - 클라언트가 서버에 SYN 패킷 전송
    - 해당 패킷에는 ISN(Init Sequence Number)가 있다
        - 32비트 무작위 숫자
        - 연결을 식별하는 숫자
- step 2
    - 서버는 클라언트에게 ACK 패킷 전송
    - 해당 패킷에는 서버의 ISN, 클라이언트 ISN+1 값이 있다
- step 3
    - 클라이언트는 서버에게 ACK 패킷 전송
    - 해당 패킷에는 서버의 ISN+1 값이 있다
    - 이 과정까지 마치면 클라이언트-서버 TCP 연결이 맺어졌다


## 연결 지향: 연결 끊기 4 way Hand Shake
- 송신자는 수신자간에 연결을 끊고 싶습니다
- step 1
    - 클라이언트가 서버에 FIN flag가 있는 패킷을 전송
    - 클라이언트는 FIN_WAIT_1 상태가 됩니다
- step 2
    - 서버는 클라이언트의 FIN flag 패킷을 확인하고 클라이언트에게 ACK 패킷 전송
    - 서버는 CLOSE_WAIT 상태가 됩니다
    - ACK를 받은 클라이언트는 FIN_WAIT_2 상태가 됩니다
- step 3
    - 서버는 클라이언트에게 보내야할 남은 데이터를 다 전송하고 FIN flag가 담긴 패킷을 마지막으로 보냅니다
    - 서버는 LAST_ACK 상태가 됩니다
- step 4
    - 클라이언트는 서버의 FIN flag 패킷을 확인하고 서버에게 ACK 패킷을 전송합니다
    - 클라이언트는 TIME_WAIT 상태가 되고 일정 시간이 지나면 연결 종료 CLOSED 상태가 됩니다
    - 서버는 ACK 패킷을 받으면 연결 종료 CLOSED 상태가 됩니다
- FIN flag의 의미
    - 나는 너에게 보낼 데이터가 더이상 없다는 의미를 담은 패킷입니다
- TIME_WAIT 상태 이유
    - 네트워크 문제로 순서가 바뀌어 전송된 패킷을 받을 대기 시간 확보
    - 서버가 자체적으로 보낼 데이터를 받을 대기 시간 확보

## 신뢰성
- 패킷 순서를 보장
- 손실 패킷 재전송

<br>

- 패킷마다 고유 번호가 있습니다
- 정상 패킷을 받은 수신자는 송신자에게 확인 메세지를 전송합니다
- 패킷의 체크섬을 이용해 손실을 확인합니다. 손실 패킷의 경우 최근 성공한 패킷의 확인 메세지를 다시 보냅니다
- 일정 시간안에 확인 메세지가 송신자에게 오지 않은 패킷에 대해 재전송을 진행합니다


## 흐름 제어
- 수신자 처리 능력에 맞춰 송신 데이터 전송 속도 조절

<br>
- 수신자는 자신이 한번에 처리할 수 있는 데이터 양을 윈도우 크기로 지정
- 윈도우 크기는 동적으로 변경가능
- 수신자는 송신자에게 윈도우 크기를 알려준다
- 버퍼가 가득차 데이터를 처리할 수 없는 경우 윈도우 크기를 0으로 조절합니다
- 윈도우 크기가 0일 경우 송신자의 전송을 일시 중지합니다
- 전송 일시 중지인 송신자는 주기적으로 작은 패킷을 보내 수신자의 윈도우 크기를 확인합니다

## 혼잡 제어
- 네트워크 상황에 맞춰 데이터 전송 속도 조절

<br>

- 송신자는 네트워크 상황에 맞춘 윈도우 크기를 조절합니다
- 윈도우 크기 만큼 메세지를 한번에 전송 가능합니다
- 연결 초기에는 1 MSS(최대 세그먼트 사이즈)로 윈도우 크기를 설정
- 매 RTT(Round Trip Time)마다 윈도우 크기를 2배 늘린다
- 임계 지점에 도달하면 윈도우 크기를 매 RTT마다 1 MSS씩 늘립니다
- 패킷 전송의 확인 메세지가 오지 않으면 1 MSS 줄입니다


## TCP 기반 프로토콜
- HTTP




# cf: 1의 보수
- 1의 보수 정의
    - 이진수의 각 비트 반전한 이진수
    - 이진수의 1의 보수 = "1" * (이진수 자리수) - 이진수
    - ex. 1010 -> 0101
- 이진수와 해당 이진수의 1의 보수를 덧셈한 경우
    - 결과값 = "1" +  "0" * (이진수 자리수)
    - 체크섬 확인시 사용
